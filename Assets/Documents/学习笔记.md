# 玩家输入模块

键盘Key / 手臂JoyStick -> 玩家输入模块 PlayerInputModel ->信号



# 新增动画控制器

Animator的Apply Root Motion属性：如果为True，则人物做移动、跳跃等动作时，会自动进行位移。

动画混合树 Bleed True：
可以通过参数（0到动画数量-1）选择播放混合树中的动画，如果是中间值，则混合播放两个动画。
可以实现动画的自然过渡效果。
表格：名称，混合树指针，播放速度，镜像反转

注意Y值是不需要设置的
TODO：角度旋转应该和四元数相关，而不是和方向向量

需要考虑从正方形左边转换为圆形坐标

跳跃状态，下落状态，在地面状态
应该优先判断是否可以直接从跳跃状态到达在地面状态，然后再判断从跳跃状态到下落状态。

RigidBody不应该在update方法中调用

```C#
rigid.position = planerMoveSpeed * Time.fixedDeltaTime;
rigid.velocity = planerMoveSpeed; 	//会覆盖y值
```

有限状态机
枚举
作为条件的方法
控制动画状态的方法（设置状态机参数，设置角色移动，以一定速度持续移动，或者固定时间的移动（`GetSmallTime()`））

Switch循环（可能需要嵌套）


待机：持续状态判定，当移动速度小于一定值时。
行走：持续状态判定，当移动速度在一定范围之间时。使用角色控制器，自定义重力属性。
奔跑：持续状态判定，当移动速度大于一定值时。和行动状态的相关方法结合在一起。
跳跃：单次触发，当按下某个按键时，使用工具方法`GetSmallTime()`，使角色在触发后一定时间内持续上升一段距离，并暂时取消重力。
下落：如果角色不在跳跃等滞空状态，且不在地面上（根据`cc.IsGrounded()`来判断）时触发。应用重力。当回到地面时，切换到在地面上状态。
翻滚：单次触发，当按下某个按键时，使用工具方法`GetSmallTime()`，使角色在触发后一定时间内持续向前移动一段固定的距离。并设置无敌帧。

FSM的连线的Interruption Source属性：当正在转换状态时，如果要中断，要切花到哪个状态。

# 26 重新修正后跃状态

精准控制后跃状态中的模型的位移速度：使用FSM曲线。
在动画对应的模型中新增曲线，右键Add Key增加折点。
新增一个同名的float类型的FSM参数，以找到曲线的引用。
在StateOnUpdate方法中持续将之设置为玩家的位移速度，并且注册到对应事件。

防止在走下坡时有一瞬间切换到Fall状态：增加OnGroundSensor.cs的offset
如果使用cc.IsGrounded，应该可行的方法：为玩家GO设置一个父GO或者兄弟GO，他们的碰撞半径更大一些，使用它们来判断玩家是否着地。

# 相机水平旋转

相机结构：
```
-PlayerHandler
    -(PlayerModel)
    -CameraContainer_X          //控制上下视角旋转，有角度限制
        -CameraContainer_Y      //控制左右视角旋转   
            -Camera             //相机本身不旋转
```

# 新增攻击动画控制层

新建Attack的FSM图层，选用FullBody的AvatarMask。
在新的图层中添加攻击状态，通过改变图层的Weight（权重）来实现功能。
Bleeding一般选用Override。

对于DS来说，攻击信号应该是没有必要清除的，按了两次就是两次攻击。





